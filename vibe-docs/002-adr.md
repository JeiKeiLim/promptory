# [ADR-001] Promptory 데스크탑 애플리케이션 아키텍처 결정

## 배경

LLM 사용이 일상화되면서 프롬프트 템플릿의 체계적 관리 필요성이 증가하고 있습니다. 사용자들은 파라미터화된 프롬프트를 효율적으로 관리하고 재사용할 수 있는 도구를 필요로 합니다.

### 현재 과제
- 프롬프트를 매번 새로 작성하거나 복사-붙여넣기하는 비효율성
- 파라미터화된 프롬프트의 체계적 관리 부족
- 로컬 파일 기반의 투명한 데이터 관리 요구

### 아키텍처 드라이버
- **성능**: 1,000개 미만 프롬프트에서 실시간 검색 (0.5초 이내)
- **투명성**: Obsidian과 유사한 로컬 파일 기반 관리
- **효율성**: 파라미터 자동 감지 및 템플릿 기반 프롬프트 생성
- **확장성**: 향후 웹앱 전환 가능성 고려
- **현대성**: Node.js v24.7.0 LTS 기반 최신 기술 스택 활용

## 결정 내용

### 선택한 아키텍처 패턴
**Electron 기반 데스크탑 애플리케이션 with 레이어드 아키텍처**

### 주요 구성 요소
1. **프레젠테이션 레이어**: React + TypeScript 기반 UI
2. **비즈니스 로직 레이어**: 프롬프트 관리, 파라미터 처리, 검색 엔진
3. **데이터 액세스 레이어**: 파일 시스템 인터페이스, 인덱싱 시스템
4. **인프라 레이어**: Electron 메인/렌더러 프로세스, 파일 감시

### 데이터 흐름
```
UI Components → State Management → Business Logic → File System
     ↑                                                    ↓
Search Index ← File Watcher ← Local Files (.md + YAML)
```

## 상태
승인됨

## 선정 이유

### 아키텍처 비교 평가 결과

| 기준 | Electron | 웹앱 | 네이티브 앱 |
|------|----------|------|-------------|
| 개발 속도 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| 크로스 플랫폼 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 파일 시스템 접근 | ⭐⭐⭐⭐⭐ | ⭐ | ⭐⭐⭐⭐⭐ |
| 성능 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 생태계 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 향후 확장성 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |

### 선정 이유
1. **로컬 파일 시스템 접근**: 마크다운 파일 직접 관리 필요
2. **크로스 플랫폼 지원**: macOS 우선이지만 향후 확장 고려
3. **개발 효율성**: TypeScript + React 생태계 활용
4. **향후 확장성**: 웹앱 전환 시 코드 재사용 가능

## 영향

### 개발 프로세스에 미치는 영향
- **긍정적**: 웹 기술 스택 활용으로 빠른 개발 가능
- **긍정적**: 풍부한 라이브러리 생태계 활용
- **주의사항**: Electron 특유의 메인/렌더러 프로세스 통신 고려 필요

### 운영에 미치는 영향
- **긍정적**: 포터블 앱으로 간단한 배포
- **주의사항**: 메모리 사용량이 네이티브 앱 대비 높을 수 있음

### 향후 확장성에 미치는 영향
- **긍정적**: 웹앱 전환 시 UI 컴포넌트 재사용 가능
- **긍정적**: 플러그인 시스템 구축 시 웹 기술 활용 가능

## 비기능 요구사항 대응

### 성능 대응
- **검색 성능**: Fuse.js 기반 실시간 검색 인덱스
- **파일 감시**: chokidar를 통한 효율적인 파일 변경 감지
- **메모리 최적화**: 가상화를 통한 대용량 프롬프트 목록 처리

### 가용성 대응
- **에러 격리**: 개별 프롬프트 파일 오류가 전체 앱에 영향 없음
- **데이터 복구**: raw 마크다운 표시를 통한 수동 복구 지원

### 보안 대응
- **로컬 저장**: 모든 데이터가 사용자 로컬에 저장
- **파일 권한**: OS 수준의 파일 접근 제어 활용

## 대안

### 고려한 다른 아키텍처 패턴

#### 1. 순수 웹 애플리케이션
- **장점**: 배포 용이성, 크로스 플랫폼
- **단점**: 로컬 파일 시스템 접근 제한
- **선택하지 않은 이유**: 파일 기반 관리 요구사항 충족 불가

#### 2. 네이티브 데스크탑 애플리케이션
- **장점**: 최고 성능, 플랫폼 최적화
- **단점**: 개발 복잡성, 크로스 플랫폼 지원 어려움
- **선택하지 않은 이유**: 개발 효율성 대비 이점 부족

#### 3. Tauri 기반 애플리케이션
- **장점**: 작은 번들 크기, 네이티브 성능
- **단점**: 상대적으로 작은 생태계, 학습 곡선
- **선택하지 않은 이유**: 생태계 성숙도 부족

## 기술 스택

### 프론트엔드
- **프레임워크**: React 18+ (생태계 우선순위)
- **언어**: TypeScript (타입 안정성)
- **상태 관리**: Zustand (단순성과 성능)
- **UI 컴포넌트**: Radix UI + Tailwind CSS
- **마크다운**: Monaco Editor + marked

### 백엔드 (Electron Main)
- **런타임**: Node.js v24.7.0 LTS
- **파일 감시**: chokidar
- **검색 엔진**: Fuse.js
- **YAML 파싱**: js-yaml
- **데이터베이스**: better-sqlite3

### 개발 도구
- **빌드**: Vite 6+ + electron-builder
- **패키지 매니저**: pnpm (성능 최적화)
- **테스트**: Vitest (단위 테스트)
- **린팅**: ESLint + Prettier
- **CI**: GitHub Actions

## 주요 구성 요소 세부 사항

### 1. 파일 관리 시스템
- **책임**: 마크다운 파일 CRUD, YAML 헤더 파싱
- **인터페이스**: IPC를 통한 메인-렌더러 통신
- **데이터 모델**: 
```typescript
interface PromptFile {
  id: string;
  path: string;
  metadata: PromptMetadata;
  content: string;
  error?: FileError;
}
```

### 2. 검색 인덱스 시스템
- **책임**: 실시간 검색 인덱스 관리
- **저장 위치**: `.promptory/search-index.json`
- **업데이트**: 파일 변경 시 실시간 업데이트
- **검색 범위**: 제목, 태그, 내용 전체

### 3. 파라미터 처리 엔진
- **책임**: `{파라미터명}` 자동 감지, YAML 헤더 동기화
- **파라미터 타입**: string, category
- **검증**: 파라미터명 규칙 (영문, 숫자, 언더스코어, 한글, 숫자로 시작 불가)

### 4. 상태 관리 아키텍처
- **메인 프로세스**: 파일 시스템 접근, 파일 감시, 인덱싱
- **렌더러 프로세스**: UI 상태, 사용자 입력, 검색 결과
- **통신 패턴**: 비동기 IPC (invoke/handle)

## 구현 정책

### 개발 환경
- **Node.js**: v24.7.0 LTS
- **패키지 매니저**: pnpm (성능 및 디스크 효율성 향상)
- **IDE**: 개발자 선택 (VS Code 권장)

### 테스트 전략
- **단위 테스트**: 비즈니스 로직, 유틸리티 함수
- **테스트 프레임워크**: Vitest
- **커버리지**: 80% 이상 목표
- **모킹**: 파일 시스템 작업은 메모리 기반 모킹

### 배포 전략
- **패키징**: electron-builder
- **배포 형태**: 포터블 애플리케이션
- **플랫폼**: macOS 우선 (향후 Windows, Linux 확장)

## 위험과 대책

### 식별된 위험

#### 1. Electron 메모리 사용량
- **위험**: 대용량 프롬프트 파일 처리 시 메모리 부족
- **대책**: 가상화, 지연 로딩, 메모리 모니터링

#### 2. 파일 동시성 문제
- **위험**: 외부 편집기와 동시 수정 시 데이터 손실
- **대책**: 파일 감시를 통한 자동 새로고침, 사용자 알림

#### 3. 크로스 플랫폼 호환성
- **위험**: 파일 경로, 권한 처리의 플랫폼별 차이
- **대책**: path 모듈 사용, 플랫폼별 테스트

#### 4. 검색 성능 저하
- **위험**: 프롬프트 수 증가 시 검색 속도 저하
- **대책**: 인덱스 최적화, 검색 결과 제한, 백그라운드 인덱싱

## 비고

### 향후 고려사항
1. **웹앱 전환**: React 컴포넌트 재사용을 위한 플랫폼 추상화 레이어 구축
2. **플러그인 시스템**: 향후 확장을 위한 이벤트 기반 아키텍처 고려
3. **성능 최적화**: 프로파일링을 통한 병목 지점 식별 및 개선
4. **접근성**: WCAG 가이드라인 준수를 위한 점진적 개선

### 유의점
- Electron 보안 모범 사례 준수 (nodeIntegration 비활성화, contextIsolation 활성화)
- 메인 프로세스와 렌더러 프로세스 간 명확한 책임 분리
- 파일 시스템 작업의 에러 처리 강화
- 사용자 데이터 백업 권장사항 제공

이 ADR은 Promptory v1.0 개발의 기본 아키텍처 가이드라인으로 활용되며, 프로젝트 진행 중 새로운 요구사항이나 제약사항 발견 시 업데이트될 수 있습니다.
